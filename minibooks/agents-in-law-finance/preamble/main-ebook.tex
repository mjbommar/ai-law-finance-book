% ============================================================================
% PREAMBLE - E-book variant (large font, narrow margins, one-sided)
% ============================================================================
% This file loads the base preamble and overrides settings for e-readers.
%
% Key differences from print version:
%   - Larger base font (13pt via extbook class in main-ebook.tex)
%   - Narrower margins (more text per page)
%   - One-sided layout (no inner/outer margin distinction)
%   - No headers (page numbers in footer only)
%   - Normalized font sizes across headings and boxes
%   - No blank verso pages
%
% Include this file with: \input{preamble/main-ebook}
% ============================================================================

% Load the full base preamble first
\input{preamble/main}

% ----------------------------------------------------------------------------
% Override Geometry for E-readers
% ----------------------------------------------------------------------------
% E-readers benefit from:
%   - Narrower margins (maximizes reading area on small screens)
%   - Symmetric margins (no binding gutter needed)
%   - Same 6x9 page size (maintains proportions)
%
% Note: \geometry{} reconfigures the already-loaded geometry package
\geometry{
  papersize={6in,9in},
  left=0.5in,
  right=0.5in,
  top=0.5in,
  bottom=0.6in,
  footskip=0.3in,
  headheight=0pt,   % No headers in ebook version
  headsep=0pt       % No space needed for headers
}

% ----------------------------------------------------------------------------
% Override Header Styles for One-sided Layout
% ----------------------------------------------------------------------------
% With oneside, there's no LE/RO distinction - all pages are "odd" (recto).
% Redefine styles to work with single-sided layout.

\fancypagestyle{frontmatterstyle}{%
  \fancyhf{}%
  % No headers for ebook - page number in footer
  \fancyfoot[C]{\thepage}% Page number centered in footer
  \renewcommand{\headrulewidth}{0pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{mainmatterstyle}{%
  \fancyhf{}%
  % No headers for ebook - margins too tight with large font
  \fancyfoot[C]{\thepage}% Page number centered in footer
  \renewcommand{\headrulewidth}{0pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{backmatterstyle}{%
  \fancyhf{}%
  % No headers for ebook - margins too tight with large font
  \fancyfoot[C]{\thepage}% Page number centered in footer
  \renewcommand{\headrulewidth}{0pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{plain}{%
  \fancyhf{}%
  % No headers for ebook - page number in footer
  \fancyfoot[C]{\thepage}% Page number centered in footer
  \renewcommand{\headrulewidth}{0pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

% ----------------------------------------------------------------------------
% E-book Typography Optimizations
% ----------------------------------------------------------------------------
% Screen reading benefits from:
%   - Increased line spacing (1.25× vs default 1.0×)
%   - Extra stretch allowance for narrow margins
%   - Same principles as web accessibility guidelines

% Load setspace if not already loaded (for \setstretch)
\makeatletter
\@ifpackageloaded{setspace}{}{\usepackage{setspace}}
\makeatother

% Increase line spacing for better screen readability
% Best practices recommend 1.5× but 1.25× balances readability with page count
\setstretch{1.25}

% Allow extra stretch to avoid overfull lines with narrow margins
\setlength{\emergencystretch}{3em}

% ----------------------------------------------------------------------------
% E-book Specific Commands
% ----------------------------------------------------------------------------

% For ebook, always disable cleardoublepage (no blank pages needed)
\AtBeginDocument{%
  \disablecleardoublepage
}

% ----------------------------------------------------------------------------
% E-book Table of Contents (shallower depth)
% ----------------------------------------------------------------------------
% Show only chapters and sections in ebook TOC (not subsections)
% This keeps the TOC concise for e-reader navigation
\setcounter{tocdepth}{1}

% ----------------------------------------------------------------------------
% E-book Font Size Normalization
% ----------------------------------------------------------------------------
% With 13pt base font, we want more consistent sizing across elements.
% Print version has section=13pt, subsection=11pt which looks odd with 13pt body.
% For ebook: keep all text closer to the 13pt base for visual consistency.

% Override section formatting (from styling.tex)
% Section: 14pt (slightly larger than 13pt body)
\titleformat{\section}
  {\fontsize{14pt}{16.8pt}\selectfont\bfseries\color{primary}}
  {\thesection}{1em}{}

% Subsection: 13pt bold (same as body, bold distinguishes it)
\titleformat{\subsection}
  {\fontsize{13pt}{15.6pt}\selectfont\bfseries\color{primary}}
  {\thesubsection}{1em}{}

% Subsubsection: 13pt bold, secondary color
\titleformat{\subsubsection}
  {\normalsize\bfseries\color{text-secondary}}
  {\thesubsubsection}{1em}{}

% ----------------------------------------------------------------------------
% E-book Box Title Size Override
% ----------------------------------------------------------------------------
% Box titles use \large in print which scales too big with larger base fonts.
% Override to use normalsize bold for consistency with body text.
\tcbset{
  fonttitle=\bfseries\normalsize
}
